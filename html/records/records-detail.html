<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width"
    />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>订单详情</title>
    <link rel="stylesheet" type="text/css" href="../../css/records/records-detail.css">
</head>

<body>
    <header class="header">
        <img src="../../image/common/back.png" alt="" class="back" onclick="javascript:kill();">
        <p class="header-title">订单详情</p>
    </header>
    <div class="order-list" id="order-list">
    </div>
    <div id="scheduleList"></div>
    <div id="footer"></div>

    <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
    <script type="text/javascript" charset="utf-8">
        var day = '';
        var id = '';
        apiready = function () {
          id = api.pageParam.id;
          day = '';
            if (!checkNet() || !checkLogin()) return;
            init();
            initList();
        }

        function init() {
            var User = $api.getStorage('User');
            request({
                url: 'GetHYJKJL',
                data: {
                    'deviceId': api.deviceId,
                    'phone': User.Phone,
                },
                tip: '正在发送...',
                operation: {
                    success: function (data) {
                      renderHtml(data);
                    },
                    fail: function (data) {

                    }
                }
            });
        };


        function renderHtml(data) {
          var htmlStr = '';
          for(var i=0;i<data.length;i++){
              for(var key in data[i]){
                if(id == data[i][key]){
                htmlStr += setHtmltitle(data[i]);
                }else{
                    toast('暂无订单详情');
                }
              }
          };
            $api.html('order-list',htmlStr);
        };


        function setHtmltitle(data) {
            day = data.DaoQiTianShu;
            var html = "<li class='recycle'>" +
            "<img src='../../image/records/recycle.png' class='recycle'>" +
            "<div class='message'>" +
            "<p class='phonetype'>" +
            " <span class='type'>手机型号</span>" +
            "<span id='phone-type'>" + api.deviceModel + "</span>" +
            "  </p>" +
            "</div>" +
            "<div class='phone-price'>" +
            "<ul>" +
            "  <li>" +
            "<p>手机估价 </p>" +
            "<span>500.00元</span>" +
            "</li>" +
            "<li>" +
            "<p>定金+预付款</p>" +
            "<span>"+(data.DaoZhang + data.FeiYong)+"元</span>" +
            "</li>" +
            "<li>" +
            "<img src='../../image/records/help.png' class='help'>"+
            "  <p>履约期</p>" +
            "<span>" + data.QiXian+ "</span>" +
            "<span>天</span>" +
            "  </li>" +
            "</ul>" +
            "  </div>" +
            "  </li>";
            return html;
        }

        function initList() {
            if (!checkNet() || !checkLogin()) return;
            if(!$api.getStorage('User')) return;

            var User = $api.getStorage('User');
            request({
                url: 'GetZXJD',
                data: {
                    sj: User.Phone,
                    deviceId: api.deviceId
                },
                'tip': '正在发送...',
                operation: {
                    success: function (data) {
                        renderContent(data);
                    },
                    error: function () {

                    }
                }
            });
        };

         function renderContent(data) {
            var html = '';
            html += sethtml(data);
            $api.html('scheduleList',html);
        };

        function sethtml(data) {

            var html = '<div class="records-details-status">' +
            ' <div class="order-content">' +
            ' <ul id="order-list">' +
            ' <li class="order-list-item">' +
            '  <ul>' +
            '<li class="currentstatus mark">' + data.ZT + '</li>' +
            '<li class="message">' +  data.FangKuanYiJian + '</li>' +
            '<li class="time">' + data.FangKuanShiJian + '</li>' +
            ' </ul>' +
            ' </li>' +
            '<li class="order-list-item">' +
            '<ul>' +   
            ' <li class="currentstatus">' + data.ZT + '</li>' +
            ' <li class="message">' + data.ShenHeYiJian + '</li>' +
            '  <li class="time">' + data.ShenHeShiJian + '</li>' +
            '</ul>' +
            ' </li>' +
            '<li class="order-list-item bodrenone">' +
            '<ul>' +
            '<li class="currentstatus">' + data.ZT + '</li>' +
            '<li class="message">您的订单已提交</li>' +
            '<li class="time">' + data.JieKuanShiJian + '</li>' +
            ' </ul>' +
            '</li>' +
            ' </ul>' +
            '</div>' +
            '<div class="schedule-icon">' +
            '<ul>' +
            '<li class="schedule-item status-success"><img src="../../image/records/success.png" alt=""></li>' +
            '<li class="schedule-item status-connect"><img src="../../image/records/connect.png" alt=""></li>' +
            '<li class="schedule-item status-success"><img src="../../image/records/currentstatus.png" alt=""></li>' +
            '<li class="schedule-item status-connect"><img src="../../image/records/connect.png" alt=""></li>' +
            '<li class="schedule-item status-success"><img src="../../image/records/currentstatus.png" alt=""></li>' +
            '</ul>' +
            '</div>' +
            '</div>' +
            '<div class="clear"></div>' +
            '</div>';
           footHtml();
          return html;
        };
        function footHtml(){
            var foot = '<div class="honour">' +
            '<div class="time">' +
            '<img src="../../image/records/time.png">' +
            '<span>'+'履约期'+(day?day:0)+'天'+'</span>' +
            '</div>' +
            '<button  class="btn" onclick="javascript:cancel();">不卖了</button>' +
            '<button  class="btn" onclick="javascript:confirm();">确定卖出填写寄回信息</button>' +
            '</div>';
            $api.html('footer', foot);
        }

        function cancel() {
            create('refund');
            //     var name = $api.val('name');
            //     var phone = $api.val('phone');
            //     User = $api.getStorage('User');
            //     var mark = false;
            //     var status;
            //         request({
            //           url: 'ApplyStatus',
            //           data: {
            //             sj: User.Phone,
            //             deviceId: api.deviceId
            //           },
            //           operation: {
            //             success: function (data) {
            //                status = data.ZhuangTai;
            //             }
            //           }
            //         });

            //         switch(status){
            //           case 3:
            //           mark = true;
            //           break;
            //           case 4:
            //           mark = true;
            //           break;
            //           case 6:
            //           mark = true;
            //           break;
            //           case 8:
            //           mark = true;
            //           break;
            //           case 10:
            //           mark = true;
            //           break;
            //           case 11:
            //           mark = true;
            //           break;
            //           case 12:
            //           mark = true;
            //           break;
            //         };
            //   if(mark){
            //       request({
            //           url: 'GetHYJKJL',
            //           data: {
            //               'deviceId': api.deviceId,
            //               'Id': '',
            //               'UserPhone': phone,
            //               'Addressee': name,
            //               'AddresseePhone': phone
            //           },
            //           tip: '正在发送...',
            //           operation: {
            //               success: function(data) {
            //                 create('refund');
            //               },
            //               fail: function() {
            //               }
            //           }
            //       });
        }


        function confirm() {
            // var name = $api.val('name');
            // var phone = $api.val('phone');
            // var addressCurrent = $api.val('address-current');
            // var addressDetail = $api.val('address-detail');
            // request({
            //     url: 'add-address',
            //     data: {
            //         'deviceId': api.deviceId,
            //         'Id': '',
            //         'UserPhone': phone,
            //         'Addressee': name,
            //         'AddresseePhone': phone,
            //         'CrrentAddress': addressCurrent,
            //         'DetailAddress': addressDetail
            //     },
            //     tip: '正在发送...',
            //     operation: {
            //         success: function(data) {
            create('add-recycle-address');
            //         }
            //     }
            // });
        }
    </script>
</body>

</html>

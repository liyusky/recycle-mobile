<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>绑定银行卡</title>
    <link rel="stylesheet" type="text/css" href="../../css/records/addcard.css">
</head>

<body>

    <header class="header">
        <img src="../../image/common/back.png" class="back" onclick="javascript: kill();">
        <p class="header-title">绑定银行卡</p>
    </header>
    <div class="content">
        <div class="content-head">
            <p class="title">绑卡只限于实名认证名下的银行卡绑定 </p>
        </div>
        <ul class="address-list-compile">
            <li>
                <p>真实姓名:</p>
                <input id="name"  type="username" placeholder="张三" class="name">
            </li>
            <li>
                <p>身份证号:</p>
                <input id="id"  type="text" placeholder="3408241998086659855">
            </li>
            <li>
                <p>银行卡号:</p>
                <input id="cardnum" type="number" placeholder="请输入银行账号">
            </li>
            <li>
                <p>开户银行:</p>
                <input  id="bank"  type="text" placeholder="请输入开户银行">
            </li>
            <li>
                <p class="phone">手机号:</p>
                <input id="phone" type="number" placeholder="请输入手机号">
            </li>
            <li>
                <p class="code">验证码:</p>
                <input id="code"  type="text" placeholder="请输入验证码">
                <a href="javascript:;" class="sendmesg">发送验证码</a>
            </li>
        </ul>
    </div>
    <button class="btn" onclick="javascript:submit();">确认绑定</button>
    <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/check.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
    <script type="text/javascript" charset="utf-8">
        var address = null;
        var certificate = null;

        function submit() {
          // if (!checkNet() || !checkLogin()) return;
            var name = $api.val('name');
            var phone = $api.val('phone');
            var cardnum = $api.val('cardnum');
            var id = $api.val('id');
            var banktype = $api.val('bank');
            var code = $api.val('code');
            var User = $api.getStorage('User');
            if(!checkBankCard(cardnum)) return;
            if(!checkID(id)) return;
            if(!checkName(name)) return;
            if(!checkPhone(phone)) return;
            if(!checkPhoneVerificationCode(code)) return;
            if(!banktype) return;
            if(isCertificate()){
              request({
                  url: 'AddYHK',
                  'data': {
                      phone: User.Phone,
                      deviceId:api.deviceId,
                      kh:cardnum,
                      yh:banktype,
                      code: code,
                      ylsj:phone
                  },
                  'tip': '正在发送...',
                  operation:{
                    success: function(data) {
                      create('yinhangka');
                      kill();
                  },
                  fail:function(){

                  }
                  }
              });
            }else{
              toast('你还没有认证!请认证');
              create('renzheng');
            }
        }

      function isCertificate() { // 是否认证
      var cardnum = $api.val('cardnum');
      var User = $api.getStorage('User');
          request({
             url:'YinHangKa_STEP1',
             'data':{
               sj:User.Phone,
               deviceId:api.deviceId,
               bankcardno:cardnum
             },
              success:function (data) {
                  certificate = true;
              },
              fail:function(){
                certificate = false;
              }
          });

        return certificate;
      }


    </script>
</body>

</html>

<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>回收进度</title>
  <link rel="stylesheet" href="../../css/records/recycling-schedule.css">
</head>

<body>
  <header class="header">
    <img src="../../image/common/back.png" alt="" class="back" onclick="javascript:kill();">
    <p class="header-title">回收进度</p>
  </header>
  <div class="content" id="content">
  </div>

  <div id="contentList"></div>

  <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
  <script>
    var qx = '0';
    apiready = function () {
      var qx = '0';
      if (!checkNet() || !checkLogin()) return;
      init();
      initList();
    }

    // 获取记录
    function init() {
      var User = $api.getStorage('User');
      request({
        url: 'GetHYJKJL',
        data: {
          'deviceId': api.deviceId,
          'phone': User.Phone
        },
        tip: '正在发送...',
        operation: {
          success: function (data) {
            if(data.length){
              renderHtml(data);
            }else{
              toast('暂无进度');
            }
          },
          fail: function (data) {

          }
        }
      });
    };


    function renderHtml(data) {
      var htmlStr = '';
      htmlStr += setHtmltitle(data[0])
      $api.html('content', htmlStr);
    };

    function setHtmltitle(data) {
      var html = '';
      qx = data.DaoQiTianShu;
      html += "<li class='recycle'>" +
        "<img src='../../image/records/recycle.png' class='recycle'>" +
        "<div class='message'>" +
        "<p class='phonetype'>" +
        " <span>手机型号</span>" +
        "<span id='phone-type'>" + api.deviceModel + "</span>" +
        "  </p>" +
        "</div>" +
        "<div class='price'>" +
        "<ul>" +
        "  <li>" +
        "<p>手机估价 </p>" +
        "<span>500.00元</span>" +
        "</li>" +
        "<li>" +
        "<p>定金+预付款</p>" +
        "<span>" + (data.DaoZhang + data.FeiYong) + "元</span>" +
        "</li>" +
        "<li>" +
        "  <p>履约期</p>" +
        "<span>" + data.QiXian + "</span>" +
        "<span>天</span>" +
        "  <img src='../../image/records/help.png' class='help'>" +
        "  </li>" +
        "</ul>" +
        "  </div>" +
        "  </li>";
      return html;
    }


    // 获取进度
    function initList() {
      if (!checkNet() || !checkLogin()) return;
      if (!$api.getStorage('User')) return;

      var User = $api.getStorage('User');
      request({
        url: 'GetZXJD',
        data: {
          sj: User.Phone,
          deviceId: api.deviceId
        },
        'tip': '正在发送...',
        operation: {
          success: function (data) {
            renderListHtml(data);
          },
          error: function () {

          }
        }
      });
    };

    function renderListHtml(data) {
      var htmlStr = '';
      htmlStr += renderList(data)
      $api.html('contentList', htmlStr);
    }


    function renderList(data) {

      var html = ' <div class="status">' +
        ' <div class="list">' +
        ' <ul id="list">' +
        ' <li class="order-list">' +
        '  <ul>' +
        '<li class="currentstatus mark">' + data.ZhuangTai + '</li>' +
        '<li class="message">' + data.FangKuanYiJian + '</li>' +
        '<li class="time">' + data.FangKuanShiJian + '</li>' +
        ' </ul>' +
        ' </li>' +
        '<li class="order-list">' +
        '<ul>' +
        ' <li class="currentstatus">' + data.ZhuangTai + '</li>' +
        ' <li class="message">' + data.ShenHeYiJian + '</li>' +
        '  <li class="time">' + data.ShenHeShiJian + '</li>' +
        '</ul>' +
        ' </li>' +
        '<li class="order-list bodrenone">' +
        '<ul>' +
        '<li class="currentstatus">' + data.ZhuangTai + '</li>' +
        '<li class="message">您的订单已提交</li>' +
        '<li class="time">' + data.JieKuanShiJian + '</li>' +
        ' </ul>' +
        '</li>' +
        ' </ul>' +
        '</div>' +
        '<div class="schedule">' +
        '<ul>' +
        '<li class="statusicon"><img src="../../image/records/success.png" alt=""></li>' +
        '<li class="connect"><img src="../../image/records/connect.png" alt=""></li>' +
        '<li class="statusicon"><img src="../../image/records/currentstatus.png" alt=""></li>' +
        '<li class="connect"><img src="../../image/records/connect.png" alt=""></li>' +
        '<li class="statusicon"><img src="../../image/records/currentstatus.png" alt=""></li>' +
        '</ul>' +
        '</div>' +
        '</div>';
      return html;
    }
  </script>
</body>

</html>
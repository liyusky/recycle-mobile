<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>回收进度</title>
  <link rel="stylesheet" href="../../css/records/recycling-schedule.css">
  <link rel="stylesheet" type="text/css" href="../../iconfont/iconfont.css">

</head>

<body>
  <header class="header">
    <img src="../../image/common/back.png" class="back" onclick="javascript:kill();">
    <p class="header-title">回收进度</p>
  </header>
  <div class="order-list" id="order-list">
  </div>
  <div id="scheduleList"></div>
  <div class="hide" id="footer">
    <div class="honour">
      <div class="time">
        <img src="../../image/records/time.png">
        <span>履约期
          <span id="period">0</span>天</span>
      </div>
      <div class="btn hide" onclick="javascript:cancel();" id="cancel">不卖了</div>
      <div class="btn hide" onclick="javascript:confirm();" id="confirm">确定卖出填写寄回信息</div>
      <div class="btn hide" onclick="javascript:contact();" id="contact">联系客服</div>
    </div>
  </div>

  <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
  <script>
    var qx = '0';
    apiready = function () {
      var qx = '0';
      if (!checkNet() || !checkLogin()) return;
      init();
      initList();
    }

    // 获取记录
    function init() {
      var User = $api.getStorage('User');
      request({
        url: 'GetHYJKJL',
        data: {
          'deviceId': api.deviceId,
          'phone': User.Phone
        },
        tip: '获取进度中...',
        operation: {
          toast: false,
          success: function (data) {
            if (data.length) {
              renderHtml(data[data.length - 1]);
            } else {
              toast('暂时还没有回收记录');
            }
          },
          fail: function (data) {

          }
        }
      });
    };


    function renderHtml(data) {
      var htmlStr = '';
      htmlStr += setHtmltitle(data);
      $api.html('order-list', htmlStr);
    }

    function setHtmltitle(data) {
      $api.text('period', data.DaoQiTianShu);
      var html = '';
      var price = null,
        contact = false, // 联系客服
        allno = false, // 什么按钮也没有
        other = false, // 不卖了 联系客服
        alung = false; // 确定卖出  不卖了
      switch (Number(data.ZhuangTai)) {
        case 0: //待审核
          allno = true;
          break;
        case 1: //审核不通过  
          allno = true;
          break;
        case 2: //待放款
          contact = true;
          break;
        case 3: //已放款
          other = true;
          break;
        case 4: //已逾期
          other = true;
          break;
        case 5: //已还款          
          allno = true;
          break;
        case 6: //已交催收
          other = true;
          break;
        case 7: //交催收已还
          allno = true;
          break;
        case 8: //交催收未还
          contact = true;
          break;
        case 9: //初审通过
          contact = true;
          break;
        case 10: //交催收延期
          contact = true;
          break;
        case 11: //未还清
          other = true;
          break;
        case 12: //交催收未还清
          contact = true;
          break;
        default:
          break;
      };
      // 联系客服
      if (contact) {
        $api.addCls('confirm', 'hide');
        $api.removeCls('contact', 'hide');
      };
      // 什么都没有
      if (allno) {
        $api.addCls('contact', 'hide');
        $api.addCls('cancel', 'hide');
        $api.addCls('confirm', 'hide')
      }
      // 不卖了 联系客服
      if (other) {
        $api.removeCls('cancel', 'hide');
        $api.removeCls('contact', 'hide');
      };
      // 确定卖出 不卖了
      if (alung) {
        $api.removeCls('cancel', 'hide');
        $api.removeCls('confirm', 'hide');
      };

      html += "<li class='recycle-list-item'>" +
        "<img src='../../image/records/recycle.png'  class='recycle'>" +
        "<div class='message'>" +
        "<p class='phonetype'>" +
        "<span class='type'>手机型号</span>" +
        "<span id='phone-type'>" + api.deviceModel + "</span>" +
        "</p>" +
        "</div>" +
        "<div class='phone-price'> " +
        "<ul>" +
        "<li>" +
        "<p>手机估价</p>" +
        "<span>" + (price = data.DaoZhang ? data.DaoZhang : data.ShenQingJine) + "元</span>" +
        "</li>" +
        "<li>" +
        "<p>定金+预付款</p>" +
        "<span>" + (price * 1 + data.FeiYong * 1) + ".00元</span>" +
        "</li>" +
        "<li>" +
        "<p>履约期</p>" +
        "<span>" + data.QiXian + "</span>" +
        "<span>天</span>" +
        "<img src='../../image/records/help.png' class='help'>" +
        "</li>" +
        "</ul>" +
        "</div>" +
        "</li>";
      $api.removeCls('footer', 'hide');
      return html;
    };

    function confirm() {
      create('add-recycle-address');
    }

    // 获取进度
    function initList() {
      if (!checkNet() || !checkLogin()) return;
      if (!$api.getStorage('User')) return;

      var User = $api.getStorage('User');
      request({
        url: 'GetZXJD',
        data: {
          sj: User.Phone,
          deviceId: api.deviceId
        },
        'tip': '正在获取回收进度...',
        operation: {
          toast: false,
          success: function (data) {
            renderListHtml(data);
          },
          error: function () {

          }
        }
      });
    };

    function renderListHtml(data) {
      var htmlStr = '';
      htmlStr += renderList(data);
      $api.html('scheduleList', htmlStr);
    }

    function renderList(data) {
      return '<div class="records-details-status">' +
        ' <div class="order-content">' +
        ' <ul id="order-list">' +
        '<li class="order-list-item bodrenone">' +
        '<ul>' +
        '<li class="currentstatus">' + data.ZT + '</li>' +
        '<li class="message">您的订单已提交</li>' +
        '<li class="time">' + data.JieKuanShiJian + '</li>' +
        ' </ul>' +
        '</li>' +
        ' </ul>' +
        '</div>' +
        '<div class="schedule-icon">' +
        '<ul>' +
        '<li class="schedule-item status-success">' +
        '<i class="iconfont success">&#xe6a2;</i>' +
        '</li>' +
        '</ul>' +
        '</div>' +
        '</div>' +
        '<div class="clear"></div>' +
        '</div>';
    };

    function contact() {
      if (!checkNet() || !checkLogin()) return;
      request({
        url: 'GetQQ',
        data: {
          deviceId: api.deviceId,
          sj: User.Phone
        },
        tip: false,
        operation: {
          toast: false,
          success: function (data) {
            var QQModule = api.require('toQQ');
            QQModule.open({ number: data });
          },
          fail: function (data) {}
        }
      });
    }
  </script>
</body>

</html>
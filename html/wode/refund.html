<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width"
  />
  <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
  <title>退款</title>
  <link rel="stylesheet" type="text/css" href="../../css/wode/refund.css">
  <script type="text/javascript" src="../../bankfont/iconfont.js"></script>
</head>

<body>

  <header class="header">
    <img src="../../image/common/back.png" class="back" onclick="javascript: kill();">
    <p class="header-title">退款</p>
  </header>
  <div class="content">
    <div class="money">
      <p class="sum">应退金额</p>
      <span class="price" id="price">500</span>
      <a href="javascript:;" class="explain">
        <img src="../../image/wode/help.png">
        <span class="explain-text">说明</span>
      </a>
    </div>
    <div class="select">
      <p>选择退款方式</p>
    </div>
    <div class="bank">
      <ul class="banklist">
        <li>
          <div class="pay-type">
            <svg class="icon" aria-hidden="true">
              <use xlink:href="#icon-GDB" id="bankIcon"></use>
            </svg>
            <p class="bank-name" id="bank-name">中国银行</p>
            <p class="cardnum">
              <span class="pass">****</span>
              <span class="pass">****</span>
              <span class="pass">****</span>
              <span class="num" id="card-tail">1234</span>
              <span class="card-type">储蓄卡</span>
            </p>
          </div>
          <img src="../../image/wode/select.png" class="select" id="card-select" onclick="javascript:select(this);">
        </li>
        <!-- <li>
          <div class="pay-type">
            <img src="../../image/wode/alipay.png" class="alipay">
            <div class="item-content">
              <p class="bank-name">支付宝</p>
              <p class="message">(支付宝将另收取2元支付通道费)</p>
            </div>
          </div>
          <div class="selectd select" id="ali-select">
            <img src="../../image/wode/check.png">
          </div>
        </li> -->
      </ul>
    </div>
  </div>
  </div>
  <div class="btn" onclick="javascript: submit();">确认退款</div>
  <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/event.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/listen.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
  <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
  <script type="text/javascript" charset="utf-8">
    var onOff = true;
    var User = null;

    apiready = function () {
      setListener();
      init();
    }

    function select(obj) {
      if (onOff) {
        obj.src = '../../image/wode/check.png';
      } else {
        obj.src = '../../image/wode/select.png';
      }
      onOff = !onOff;
    }

    function init() {
      User = $api.getStorage('User');
      if (!checkNet() || !checkLogin()) return;
      request({
        url: 'PaymentAmount',
        data: {
          sj: User.Phone,
          deviceId: api.deviceId
        },
        operation: {
          success: function (data) {
            data = formatData(data);
            render(data);
          },
          default: function () {}
        }
      });
      request({
        url: 'GetHYYHK',
        data: {
          phone: User.Phone,
          deviceId: api.deviceId
        },
        operation: {
          success: function (data) {
            renderbankType(data);
          },
          default: function () {}
        }
      });
    };

     var bankImg = {
      '广东发展银行': '#icon-GDB',
      '浦发银行':'#icon-SPDB',
      '农村信用合作社':'#icon-nongcunxinyonghezuoshe',
      '民生银行':'#icon-CMBC',
      '交通银行':'#icon-BOCOM',
      '中信银行':'#icon-CCITICB',
      '恒丰银行':'#icon-EGB',
      '华夏银行':'#icon-HXB',
      '工商银行':'#icon-ICBC',
      '中国建设银行':'#icon-CCB',
      '招商银行':'#icon-CMB',
      '中国光大银行':'#icon-CEB',
      '兴业银行':'#icon-RHB',
      '中国银行':'#icon-BoC',
      '农业银行':'#icon-ABC',
      '邮政储蓄银行':'#icon-PSBC',
      '平安银行':'#icon-PABC',
      '农商银行':'#icon-OCB'
     }

    function renderbankType(data){
      $api.text('card-tail',data[0].WeiHao);
      $api.text('bank-name',data[0].KaiHuHang);
      for(var key in bankImg){
         if(key == data[0].KaiHuHang){
          $api.attr('bankIcon','xlink:href',bankImg[key]);
         }
      }
    }

    function submit() {
      if (!checkNet() || !checkLogin()) return;
      create('pay');
    }

    function render(data) {
      $api.text('price', data.price);
    }

    function formatData(data) {
      return {
        price: data.JinE,
        tail: User.Card.substr(-4)
      }
    }

    function setListener() {
      loginEventListener();
      logoutEventListener(function () {
        kill();
      });
    }
  </script>
</body>

</html>
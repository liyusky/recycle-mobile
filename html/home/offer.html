<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>手机报价</title>
  <link rel="stylesheet" href="../../css/home/offer.css">
</head>

<body>
  <header class="header">
    <img src="../../image/common/back.png" alt="" class="back" onclick="javascript: kill();">
    <p class="header-title">手机报价</p>
  </header>
  <div class="banner">
    <img src="../../image/home/quote-banner.png" alt="">
    <div class="bannerText">
      <p class="message">
        <span>您的手机</span>
        <span id="type">iphone 6s</span>
        <span>估价</span>
      </p>
      <h3 class="money">
        <span>￥</span>
        <span id="money">500</span>
      </h3>
      <span class="anew" id="valuation">重新估价></span>
    </div>
  </div>
  <div class="load hide" id="loading">
      <img src="../../image/home/load.gif" class="load-img">
  </div>
  <div class="details">
    <div class="rules">
      <div class="ruleshead">
        <img src="../../image/home/flow.png">
        <p class="rules-title">反悔/撤销</p>
        <div class="clear"></div>
      </div>
      <div class="rules-text">
        用户根据手机实际状况填写确认手机检测评估信息后， 根据平台提供的报价决定是否进行出售;若用户确定出手的,用户需根据 平台要求替换手机iCloud账号并与平台签订相关交易文本,用户操作完成后, 平台即刻向用户支付一定比例的定金及预付款;待平台实际收到用户手机并
        验收通过后向用户支付尾款部分。
      </div>
    </div>
    <div class="rules">
      <div class="ruleshead">
        <img src="../../image/home/repeal.png" alt="">
        <p class="rules-title">出售流程</p>
      </div>
      <div class="clear"></div>
      <div class="rules-text">
        用户在与平台签订《手机回收合同》并收到平台支付款项后拥有7个 自然日的履约期,履约期内用户可选择撤销出售手机,解除原合同, 但应向平台退回预付款并双倍返还定金。
      </div>
    </div>
    <div class="rules">
      <div class="ruleshead">
        <img src="../../image/home/contract.png" alt="">
        <p class="rules-title"> 重新签约</p>
      </div>
      <div class="clear"></div>
      <div class="rules-text">
        用户在撤销出售手机(解除愿《手机回收合同》)后，亦可选择将该手机 再次向平台出售手机,仅需签订相关交易文本,无需进行其他流程。
      </div>
    </div>
    <div class="affirm">
        <p class="protocol">
            <input type="checkbox" id="checkbox">
            <label for="checkbox" value='√'>
              <span class="icon">✔</span>
              我阅读并理解 《手机合同》
            </label>
          </p>
    </div>
    <button class="btn" onclick="javascript: submit();">马上拿钱</button>
    <script type="text/javascript" charset="utf-8" src="../../script/global/api.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/request.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/request-status.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/router.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/base.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/global/urls.js"></script>
    <script type="text/javascript" charset="utf-8" src="../../script/component/other/toggleBtnDisabled.js"></script>
    <script>
      var User = null;
      apiready = function () {
        User = $api.getStorage('User');
        init();
      };

      $api.byId('valuation').onclick = function(){
        $api.removeCls('loading','hide');
      }

      function init() {
        if (!checkNet() || !checkLogin()) return;
        $api.text('type', api.deviceModel);

        request({
          url: 'PhonePrice',
          data: {
            phone: User.Phone,
            deviceId: api.deviceId,
            DeviceModel: api.deviceModel
          },
          operation: {
            toast: false,
            success: function (data) {
              $api.text('money', data.Price);
              $api.addCls('loading','hide');
            }
          }
        });
        request({
          url: 'Certification',
          data: {
            sj: User.Phone,
            deviceId: api.deviceId
          },
          operation: {
            toast: false,
            success: function (data) {
              var message = data.HYXX;
              var card = data.YHK;
              User = $api.getStorage('User');
              if (card) {
                User.Card = card.KaHao;
              }
              User.Name = message.XingMing;
              User.Id = message.ShenFenZheng;
              User.Certification[0] = !!(message.IsCertification * 1);
              User.Certification[1] = !!(message.IsTxl * 1);
              User.Certification[2] = !!(message.IsZhiMa * 1);
              User.Certification[3] = !!(message.IsOperator * 1);
              $api.setStorage('User', User);
            }
          }
        });
      }

      function submit() {
        if (!checkNet() || !checkLogin()) return;
        var agreement = $api.byId('checkbox').checked;
        if (!agreement) {
          toast('请同意报价合同!');
          return;
        }

        var mark = true;
        User.Certification = [true, true, true, true]
        for (let i = 0; i < 4; i++) {
          if (!User.Certification[i]) mark = false;
        }

        if (!mark) {
          toast('请完成认证');
          create('personal-information');
          kill();
          return;
        }

        if (!User.Card) {
          toast('请绑定银行卡');
          create('add-bank-card');
          kill();
          return;
        }
        request({
          url: 'SubmitApply',
          'data': {
            sj: User.Phone,
            deviceId: api.deviceId,
            JinE: 500,
            QiXian: 7,
            FeiYong: 105,
            RuZhangKa: User.Card,
            txl: '',
            ly: '0',
            PhoneName: '',
            PhoneModel: api.deviceModel,
            StorageSpace: '8',
            SerialNumber: '',
            IMEI: '',
            ICCID: '',
            MEID: '',
            SEID: ''
          },
          tip: '正在发送...',
          operation: {
            init: function () {
              closeBtnClick('submit-btn');
            },
            success: function (data) {
              create('submit-order');
              kill();
            },
            default: function () {
              openBtnClick('submit-btn');
            }
          }
        });
      }
    </script>

</body>

</html>
